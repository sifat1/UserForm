@model UserForm.ViewModels.Analytics.FormAnalyticsViewModel

@{
    Layout = "_Blank";
    ViewData["Title"] = "Form Analytics";
}

<div class="container my-5">
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <h2 class="card-title">Analytics for: <span class="text-primary">@Model.FormTitle</span></h2>
            <p class="mb-1"><strong>Topic:</strong> @Model.FormTopic</p>
            <p><strong>Total Responses:</strong> @Model.TotalResponses</p>
        </div>
    </div>

    @foreach (var q in Model.Questions)
    {
        <div class="card shadow-sm mb-4">
            <div class="card-body">
                <h4 class="card-title">@q.QuestionText <small class="text-muted">(@q.QuestionType)</small></h4>

                @if (q.QuestionType == "Number")
                {
                    <p class="mt-2"><strong>Average value:</strong> @(q.AverageNumberAnswer?.ToString("F2") ?? "N/A")</p>
                }
                else if (q.QuestionType == "MultipleChoice")
                {
                    <ul class="list-group mt-3">
                        @foreach (var kvp in q.OptionFrequency)
                        {
                            var percentage = Model.TotalResponses > 0 ? (kvp.Value * 100.0 / Model.TotalResponses) : 0;
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span>@kvp.Key</span>
                                <span class="badge bg-primary rounded-pill">@kvp.Value (@percentage.ToString("F1")%)</span>
                            </li>
                        }
                    </ul>
                }
                else if (q.QuestionType == "Text")
                {
                    <p class="mt-2"><strong>Text answers collected:</strong> @q.OptionFrequency.Values.Sum()</p>
                }
            </div>
        </div>
    }
</div>
